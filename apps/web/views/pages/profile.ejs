<link rel="stylesheet" href="/assets/css/profile.css" />
<div id="profile" class="flex col gap-16" data-reload-socket-room="user_<%= user.id %>,maps" data-reload-on-show="true">
    <%- include('../partials/statSettings') %> <%- include('../partials/profile/cardImportProgress', { updateStatus })
    %>
    <section id="profileContent" class="card flex col gap-8" data-reload-socket-event="update_profile">
        <div class="banner relative rounded-8 w-full" style="background-image: url('<%= user.banner_url %>')">
            <div class="buttons absolute flex row-rev gap-8 flex-wrap">
                <a
                    class="btn translucent square"
                    href="https://osu.ppy.sh/users/<%= user.id %>"
                    target="_blank"
                    title="View profile on osu! website">
                    <span class="icon">open_in_new</span>
                </a>
                <button id="showSharePopup" class="btn translucent">
                    <span class="icon">share</span>
                    <span>share & embed...</span>
                </button>
                <!-- Handle showing dynamic share popup -->
                <script>
                    document.querySelector('#showSharePopup').addEventListener('click', () => {
                        const dialog = showPopup(`Share profile`, ``, [{ label: 'Close' }], {
                            width: 800,
                            height: 900,
                            onBeforeShow: async dialog => {
                                dialog.querySelector('.body').id = 'sharePopupBody';
                                await reloadElement('#sharePopupBody');
                            }
                        });
                    });
                </script>
            </div>
        </div>
        <div class="basics overflow-hidden flex gap-16 align-center">
            <img src="<%= user.avatar_url %>" class="avatar rounded-24 flex-no-shrink" />
            <div class="text overflow-hidden text-ellipsis nowrap flex col gap-4 flex-grow">
                <div class="name overflow-hidden text-ellipsis nowrap"><%= user.name %></div>
                <div class="flags flex flex-wrap align-center">
                    <div class="country flex gap-4 align-center">
                        <img src="<%= user.country.flag_url %>" class="flag rounded-4" />
                        <span class="label"><%= user.country.name %></span>
                    </div>
                    <% if (user.team.id) { %>
                    <div class="team flex gap-4 align-center">
                        <img src="<%= user.team.flag_url %>" class="flag rounded-4" />
                        <span class="label"><%= user.team.name %></span>
                    </div>
                    <% } %>
                </div>
            </div>
            <!-- This is just the stats to the right of the avatar and name -->
            <%- include('../partials/profile/basicStats', { stats }) %>
        </div>

        <!-- Include completion progress card -->
        <%- include('../partials/profile/cardCompletionProgress', { user, stats, historyDaily, yearly, yearlyType,
        updateStatus }) %>

        <!-- Include play next card if we have recommendations -->
        <%- recommended ? include('../partials/profile/cardPlayNext', { recommended, recommendedQuery, category }) : ''
        %>

        <!-- Include recent passes card -->
        <%- include('../partials/profile/cardRecentPasses', { recentPasses }) %>
    </section>
</div>
