<link rel="stylesheet" href="/assets/css/recommended.css">
<div class="flex col gap-16">
    <%- include('../partials/statSettings') %>
    <div id="recommended" class="card flex col" data-reload-socket-room="user_<%= locals?.me?.id %>"
        data-reload-on-show="true">
        <form class="settings flex col gap-8" data-reload-selectors="#results,#searchHint">
            <div class="inputs flex gap-8">
                <div class="textbox medium hasIcon flex-grow">
                    <span class="icon">search</span>
                    <input type="text" name="q" id="inputQuery" class="input" placeholder="<%= placeholder %>"
                        value="<%= settings.query %>" autocapitalize="none" autocomplete="off" spellcheck="false">
                </div>
                <div class="flex row gap-8">
                    <div class="textbox medium select hasIcon flex-grow">
                        <span class="icon">sort</span>
                        <select name="sort" class="input" id="inputSort">
                            <% for (const type of settings.sortTypes) { %>
                            <option value="<%= type.id %>" <%= type.id === (settings.sort || '') ? 'selected' : '' %>>
                                <%= type.name %>
                            </option>
                            <% } %>
                        </select>
                    </div>
                </div>
            </div>
            <div class="hint flex align-center">
                <button class="help btn small text accent" id="filterHelpButton" type="button">
                    <span class="icon">filter_alt</span>
                    <span class="label">Filter help</span>
                </button>
                <div id="searchHint" class="status" data-reload-socket-event="update_stats">
                    Found <%= results.total_matches.toLocaleString() %> un-passed maps
                </div>
            </div>
        </form>
        <div id="results" <%- settings.sort !== '' ? 'data-reload-socket-event="update_stats"' : '' %>>
            <% if (results.beatmaps.length) { %>
            <div class="card lighter flex col gap-8" style="padding: 8px;">
                <div class="flex align-center justify-center flex-wrap gap-8">
                    <a href="/recommended/<%= category %>/surprise?dest=direct&q=<%= encodeURIComponent(settings.query) %>"
                        class="btn primary">
                        <span class="icon filled">casino</span>
                        <span class="label">Pick for me (osu!direct)</span>
                    </a>
                    <a target="_blank"
                        href="/recommended/<%= category %>/surprise?dest=osu&q=<%= encodeURIComponent(settings.query) %>"
                        class="btn">
                        <span class="icon filled">casino</span>
                        <span class="label">Pick for me (osu!web)</span>
                    </a>
                </div>
                <div class="beatmapCardContainer">
                    <% for (const beatmap of results.beatmaps) { %>
                    <%- include('../partials/beatmap/card', { beatmap }) %>
                    <% } %>
                </div>
            </div>
            <% } else { %>
            <div class="flex col gap-16 align-center noResults">
                <div class="icon">help</div>
                <p>Either your search found no maps or you've passed them all.</p>
            </div>
            <% } %>
        </div>
    </div>
</div>
<dialog id="filterHelpPopup" class="popup" closedby="any" style="--width: 800px">
    <div class="title">Searching and filtering help</div>
    <div class="body"><%- filterHelpHtml %></div>
    <div class="actions">
        <button class="btn primary medium" id="filterHelpClose">Got it</button>
    </div>
</dialog>
<script>
    const btnFilterHelp = document.querySelector('#filterHelpButton');
    const filterHelpPopup = document.querySelector('#filterHelpPopup');
    const btnFilterHelpClose = document.querySelector('#filterHelpClose');
    // Show filter help popup
    btnFilterHelp.addEventListener('click', (e) => {
        e.preventDefault();
        filterHelpPopup.showModal();
    });
    // Close filter help popup
    btnFilterHelpClose.addEventListener('click', (e) => {
        filterHelpPopup.close();
    });
</script>